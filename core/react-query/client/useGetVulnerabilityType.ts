"use client";
import { I_GetVulnerabilityTypeSuccessResponse } from "@/core/models/common";
import { I_GetErrorResponse } from "@/core/models/hacker/programs";
import { fetchGetVulnerabilityType } from "@/core/services/common";
import { keepPreviousData, useQuery } from "@tanstack/react-query";

export const useGetVulnerabilityType = () => {
  const { data, error, isError, isSuccess } = useQuery<
    I_GetVulnerabilityTypeSuccessResponse,
    I_GetErrorResponse
  >({
    queryKey: ["getVulnerabilityType"],
    queryFn: () => fetchGetVulnerabilityType(),
    placeholderData: keepPreviousData,
    refetchOnMount: false,
  });

  if (isError) {
    return {
      data: [],
      error,
      isError,
    };
  }

  const vulnerabilityData = data?.data || [];
  if (isSuccess) {
    return {
      data: [
        ...vulnerabilityData,
        { id: "other", value: "other", label: "Other", group: "vulnerability" },
      ],
      error,
      isError,
    };
  }

  return {
    data: vulnerabilityData,
    error,
    isError,
  };
};
